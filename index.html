<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Online - Lista de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="container-fluid bg-light py-3">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="barra-busqueda-izquierda d-flex">
                <input type="text" class="form-control me-2" placeholder="Buscar productos...">
                <button type="submit" class="btn btn-outline-secondary">Buscar</button>
            </div>
            <nav class="barra-navegacion-izquierda-hm">
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Mujer</a>
                        <ul>
                            <li><a href="#">Ropa</a></li>
                            <li><a href="#">Zapatos</a></li>
                            <li><a href="#">Accesorios</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Hombre</a>
                        <ul>
                            <li><a href="#">Ropa</a></li>
                            <li><a href="#">Zapatos</a></li>
                            <li><a href="#">Accesorios</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Niños</a>
                        <ul>
                            <li><a href="#">Ropa</a></li>
                            <li><a href="#">Zapatos</a></li>
                            <li><a href="#">Juguetes</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Sport</a>
                        <ul>
                            <li><a href="#">Ropa Deportiva</a></li>
                            <li><a href="#">Calzado Deportivo</a></li>
                            <li><a href="#">Accesorios Deportivos</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Rebajas</a>
                        <ul>
                            <li><a href="#">Todas las Rebajas</a></li>
                            <li><a href="#">Ropa con Descuento</a></li>
                            <li><a href="#">Accesorios en Oferta</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <p class="mb-0 d-none d-md-block">Explora nuestra selección de productos con los mejores precios.</p>
            <div class="carrito-icono">
                <span id="cantidad-carrito" class="badge bg-danger rounded-pill">0</span>
                <img src="img-tienda2/Logotipo Carrito de Compras de Supermercado Minimalista Naranja y Rojo.png" alt="Carrito">
            </div>
        </div>
    </header>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-9 productos">
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/9c7a885c9ed4389a84316f0388052655.webp" class="card-img-top" alt="Zapatos">
                    <div class="card-body text-center">
                        <p class="precio card-text">$10.99</p>
                        <h5 class="nombre-producto card-title">Zapatos</h5>
                        <button class="boton-agregar btn btn-primary">Añadir al carrito</button>
                    </div>
                </div>
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/w=800,h=800,fit=pad.avif" class="card-img-top" alt="Camisa">
                    <div class="card-body text-center">
                        <p class="precio card-text">$15.99</p>
                        <h5 class="nombre-producto card-title">Camisa</h5>
                        <div class="selector-talla">
                            <label for="talla-camisa" class="form-label">Talla:</label>
                            <select class="form-select talla-select" id="talla-camisa">
                                <option value="">Seleccionar</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                            </select>
                        </div>
                        <button class="boton-agregar btn btn-primary mt-2">Añadir al carrito</button>
                    </div>
                </div>
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/1698574544ecd7d826d3bafe9749acc82bba70464b_thumbnail_720x.jpg" class="card-img-top" alt="Cinturon">
                    <div class="card-body text-center">
                        <p class="precio card-text">$9.59</p>
                        <h5 class="nombre-producto card-title">Cinturon</h5>
                        <button class="boton-agregar btn btn-primary">Añadir al carrito</button>
                    </div>
                </div>
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/e180d93b-817c-4c33-a8ba-9fa590228b31.webp" class="card-img-top" alt="Medias">
                    <div class="card-body text-center">
                        <p class="precio card-text">$7.49</p>
                        <h5 class="nombre-producto card-title">Medias</h5>
                        <button class="boton-agregar btn btn-primary">Añadir al carrito</button>
                    </div>
                </div>
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/Pantal_n_Satinado_para_mujer_dyaboo_1890032_crudo_600x.jpg" class="card-img-top" alt="Pantalón">
                    <div class="card-body text-center">
                        <p class="precio card-text">$12.29</p>
                        <h5 class="nombre-producto card-title">Pantalón</h5>
                        <div class="selector-talla">
                            <label for="talla-pantalon" class="form-label">Talla:</label>
                            <select class="form-select talla-select" id="talla-pantalon">
                                <option value="">Seleccionar</option>
                                <option value="30">30</option>
                                <option value="32">32</option>
                                <option value="34">34</option>
                            </select>
                        </div>
                        <button class="boton-agregar btn btn-primary mt-2">Añadir al carrito</button>
                    </div>
                </div>
                <div class="producto card shadow-sm">
                    <img src="img-tienda2/devre-saco_02d000118-060_001.webp" class="card-img-top" alt="Saco">
                    <div class="card-body text-center">
                        <p class="precio card-text">$16.89</p>
                        <h5 class="nombre-producto card-title">Saco</h5>
                        <div class="selector-talla">
                            <label for="talla-saco" class="form-label">Talla:</label>
                            <select class="form-select talla-select" id="talla-saco">
                                <option value="">Seleccionar</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <button class="boton-agregar btn btn-primary mt-2">Añadir al carrito</button>
                    </div>
                </div>
            </div>
            <aside class="col-md-3">
                <div class="ordenamiento mb-4">
                    <h4>Ordenar por:</h4>
                    <select class="form-select" id="ordenar-productos">
                        <option value="precio-asc">Precio (Menor a Mayor)</option>
                        <option value="precio-desc">Precio (Mayor a Menor)</option>
                        <option value="nombre-asc">Nombre (A-Z)</option>
                        <option value="nombre-desc">Nombre (Z-A)</option>
                    </select>
                </div>
                <div class="carrito-detalle bg-light p-3 rounded">
                    <h2>Carrito de Compras</h2>
                    <div id="lista-carrito">
                        </div>
                    <p id="total-carrito" class="fw-bold mt-2">Total: $0.00</p>
                    <button id="boton-comprar" class="btn btn-success w-100">Comprar</button>
                </div>
            </aside>
        </div>
    </div>
    <div class="container mt-4 imagen-abajo">
        <img src="img-tienda2/Tienda Moda.png" alt="Imagen al final de la página" class="img-fluid">
    </div>
    <footer class="mt-4 bg-light text-center py-2">
        <p class="mb-0">@ David Morales</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Carrito de compras JS (original)
            const botonesAgregarCarrito = document.querySelectorAll('.boton-agregar');
            const cantidadCarritoElement = document.getElementById('cantidad-carrito');
            const listaCarritoElement = document.getElementById('lista-carrito');
            const totalCarritoElement = document.getElementById('total-carrito');
            const botonComprar = document.getElementById('boton-comprar');
            const carrito = [];

            function actualizarCarritoVisual() {
                cantidadCarritoElement.textContent = carrito.length;
                listaCarritoElement.innerHTML = '';
                let total = 0;

                carrito.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('item-en-carrito');
                    let detallesTalla = item.talla ? `<span class="detalle-talla">Talla: ${item.talla}</span>` : '';
                    itemDiv.innerHTML = `
                        <img src="${item.imagen}" alt="${item.nombre}" width="50">
                        <p>${item.nombre} ${detallesTalla}</p>
                        <p>${item.precio}</p>
                        <span class="cantidad-item">(${item.cantidad})</span>
                        <button class="boton-eliminar-item" data-index="${index}">Eliminar</button>
                    `;
                    listaCarritoElement.appendChild(itemDiv);
                    total += parseFloat(item.precio.replace('$', '')) * item.cantidad;
                });

                totalCarritoElement.textContent = `Total: $${total.toFixed(2)}`;

                const botonesEliminarItem = document.querySelectorAll('.boton-eliminar-item');
                botonesEliminarItem.forEach(boton => {
                    boton.addEventListener('click', function() {
                        const indexAEliminar = parseInt(this.dataset.index);
                        carrito.splice(indexAEliminar, 1);
                        actualizarCarritoVisual();
                    });
                });
            }

            botonesAgregarCarrito.forEach(boton => {
                boton.addEventListener('click', function() {
                    const productoDiv = this.parentNode.parentNode; // Subimos al div del producto (card)
                    const imagenSrc = productoDiv.querySelector('.card-img-top').src;
                    const precioTexto = productoDiv.querySelector('.precio').textContent;
                    const nombre = productoDiv.querySelector('.nombre-producto').textContent;
                    const selectorTalla = productoDiv.querySelector('.talla-select');
                    let tallaSeleccionada = selectorTalla ? selectorTalla.value : null;

                    if (productoDiv.classList.contains('con-talla') && !tallaSeleccionada) {
                        alert(`Por favor, selecciona la talla para ${nombre}.`);
                        return;
                    }

                    const productoExistente = carrito.find(item => item.nombre === nombre && item.talla === tallaSeleccionada);

                    if (productoExistente) {
                        productoExistente.cantidad++;
                    } else {
                        carrito.push({
                            imagen: imagenSrc,
                            precio: precioTexto,
                            nombre: nombre,
                            cantidad: 1,
                            talla: tallaSeleccionada
                        });
                    }
                    actualizarCarritoVisual();
                });
            });

            botonComprar.addEventListener('click', () => {
                if (carrito.length > 0) {
                    alert('¡Gracias por tu compra!');
                    carrito.length = 0;
                    actualizarCarritoVisual();
                } else {
                    alert('El carrito está vacío. ¡Agrega algunos productos!');
                }
            });

            actualizarCarritoVisual();


            const barraBusquedaInput = document.querySelector('.barra-busqueda-izquierda input[type="text"]');
            const botonBusqueda = document.querySelector('.barra-busqueda-izquierda button[type="submit"]');
            const productosDivBusqueda = document.querySelector('.productos');
            const productosOriginalesBusqueda = Array.from(productosDivBusqueda.children);

            function filtrarProductos(textoBusqueda) {
                const textoLower = textoBusqueda.toLowerCase();
                productosDivBusqueda.innerHTML = '';

                productosOriginalesBusqueda.forEach(producto => {
                    const nombreProducto = producto.querySelector('.nombre-producto').textContent.toLowerCase();
                    const descripcionProducto = producto.querySelector('.descripcion')?.textContent.toLowerCase() || '';

                    if (nombreProducto.includes(textoLower) || descripcionProducto.includes(textoLower)) {
                        productosDivBusqueda.appendChild(producto.cloneNode(true));
                    }
                });

                if (productosDivBusqueda.children.length === 0) {
                    productosDivBusqueda.innerHTML = '<p>No se encontraron productos.</p>';
                }

                adjuntarEventListenersCarrito();
            }

            botonBusqueda.addEventListener('click', () => {
                const textoBusqueda = barraBusquedaInput.value.trim();
                filtrarProductos(textoBusqueda);
            });

            barraBusquedaInput.addEventListener('input', () => {
                const textoBusqueda = barraBusquedaInput.value.trim();
                filtrarProductos(textoBusqueda);
            });


            const ordenarSelect = document.getElementById('ordenar-productos');
            const productosDivOrden = document.querySelector('.productos');
            const productosOriginalesOrden = Array.from(productosDivOrden.children);

            function ordenarProductos(criterio) {
                let productosAOrdenar = Array.from(productosDivOrden.children);

                productosAOrdenar.sort((a, b) => {
                    let valorA, valorB;

                    switch (criterio) {
                        case 'precio-asc':
                            valorA = parseFloat(a.querySelector('.precio').textContent.replace('$', ''));
                            valorB = parseFloat(b.querySelector('.precio').textContent.replace('$', ''));
                            return valorA - valorB;
                        case 'precio-desc':
                            valorA = parseFloat(a.querySelector('.precio').textContent.replace('$', ''));
                            valorB = parseFloat(b.querySelector('.precio').textContent.replace('$', ''));
                            return valorB - valorA;
                        case 'nombre-asc':
                            valorA = a.querySelector('.nombre-producto').textContent.toLowerCase();
                            valorB = b.querySelector('.nombre-producto').textContent.toLowerCase();
                            return valorA.localeCompare(valorB);
                        case 'nombre-desc':
                            valorA = a.querySelector('.nombre-producto').textContent.toLowerCase();
                            valorB = b.querySelector('.nombre-producto').textContent.toLowerCase();
                            return valorB.localeCompare(valorA);
                        default:
                            return 0;
                    }
                });

                productosDivOrden.innerHTML = '';
                productosAOrdenar.forEach(producto => {
                    productosDivOrden.appendChild(producto);
                });
                // **Importante:** Re-adjuntar event listeners después de ordenar
                adjuntarEventListenersCarrito();
            }

            ordenarSelect.addEventListener('change', () => {
                const criterioSeleccionado = ordenarSelect.value;
                ordenarProductos(criterioSeleccionado);
            });

            // Función para adjuntar event listeners al botón "Añadir al carrito"
            function adjuntarEventListenersCarrito() {
                const botonesAgregarNuevos = document.querySelectorAll('.productos .boton-agregar');
                botonesAgregarNuevos.forEach(boton => {
                    boton.removeEventListener('click', agregarAlCarrito);
